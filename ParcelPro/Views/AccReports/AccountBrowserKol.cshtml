@model AccountsBrowserDto
@{
    ViewData["Title"] = "مدیریت مالی گارنت - مرورگر حساب ها";
    Layout = "~/Views/Shared/_Layout.cshtml";

    long totalBed = Model.Kols.Sum(n => n.Bed);
    long totalBes = Model.Kols.Sum(n => n.Bes);
    long ekhtelaf = totalBed >= totalBes ? totalBed - totalBes : totalBes - totalBed;

    string strTotalBed = totalBed > 0 ? totalBed.ToPrice() : "0";
    string strTotalBes = totalBes > 0 ? totalBes.ToPrice() : "0";
    string strEkhtelaf = ekhtelaf > 0 ? ekhtelaf.ToPrice() : "0";
    string status = (ekhtelaf > 0 && totalBed > totalBes) ? "بدهکار" : ((ekhtelaf > 0 && totalBes > totalBed) ? "بستانکار" : "");
}


<div class="card">
    <div class="card-header  alert-secondary">
        <div class="card-header-custom1 mb-2">
            <h5>مرورگـر حساب ها</h5>
            @*<div class="btn-toolbar demo-inline-spacing" role="toolbar" aria-label="Toolbar with button groups">
                <div class="btn-group" role="group" aria-label="First group">
                    <a href="javascript:void(0)" class="btn btn-sm btn-primary newdoc" data-url="@Url.Action("CreateDocHeader","OpAccoucnting",new{Area=""})">
                        <i class="tf-icons bx bx-plus me-2"></i>
                        سنــد جدید
                    </a>
                </div>
            </div>*@
        </div>

        <div class="accordion accordion-header-warning" id="accordionWithIcon">
            <div class="accordion-item">
                <h2 class="accordion-header d-flex align-items-center">
                    <a class="accordion-button collapsed" data-bs-toggle="collapse" data-bs-target="#accordionWithIcon-1" aria-expanded="false">
                        <i class="bx bx-search me-2"></i>
                        <span>فیلتر پیشرفته</span>
                    </a>
                </h2>

                <div id="accordionWithIcon-1" class="accordion-collapse collapse" style="">
                    <div class="accordion-body lh-2">
                        <form asp-action="AccountBrowserKol" asp-controller="AccReports" asp-area="" method="get" id="frm_accBrowser">

                            <div class="row">
                                <div class="col-sm-6 col-md-1 mb-1">
                                    <label asp-for="filter.FromDocNumer" class="form-label">‌از شماره سند</label>
                                    <input type="number" name="FromDocNumer" asp-for="filter.FromDocNumer" class="form-control text-center">
                                </div>
                                <div class="col-sm-6 col-md-1 mb-1">
                                    <label asp-for="filter.ToDocNumer" class="form-label">تا شماره سند‌</label>
                                    <input type="number" name="ToDocNumer" asp-for="filter.ToDocNumer" class="form-control text-center">
                                </div>
                                <div class="col-md-2 mb-2">
                                    <label asp-for="filter.StartDate" class="form-label">از تاریخ‌</label>
                                    <input type="text" name="strStartDate" asp-for="filter.strStartDate" class="form-control flatpickr-input" placeholder="YYYY/MM/DD" id="flatpickr-date">
                                </div>
                                <div class="col-md-2 mb-2">
                                    <label asp-for="filter.EndDate" class="form-label">از تاریخ‌</label>
                                    <input type="text" name="strEndDate" asp-for="filter.strEndDate" class="form-control flatpickr-input" placeholder="YYYY/MM/DD" id="flatpickr-date">
                                </div>
                                <div class="col-sm-6 col-md-1 mb-1">
                                    <label for="flatpickr-date" class="form-label">وضعیت سند</label>
                                    <select class="form-select" asp-for="filter.docType" name="docType" asp-items="@ViewBag.docType">
                                        <option value="null" selected>همه</option>
                                    </select>
                                </div>
                                <div class="col-md-1 mb-1">
                                    <input type="submit" class="btn btn-secondary mt-4" value="نمایش" />
                                </div>
                            </div>

                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="reportPlace" id="accountBrowswePlace">
        <div class="card-body m-0">
            <div class="table-responsive text-nowrap">
                <table class="table table-striped table-bordered">
                    <thead class="table-dark">
                        <tr>
                            <th class="text-center">ردیف</th>
                            <th>کد حساب</th>
                            <th>نام حساب</th>
                            <th>ماهیت حساب</th>
                            <th>بدهکار</th>
                            <th>بستانکار</th>
                            <th>مانده</th>
                            <th>وضعیت حساب</th>
                        </tr>
                    </thead>
                    <tbody class="table-border-bottom-0">
                        @if (Model.Kols?.Count() > 0)
                        {
                            int row = 1;
                            foreach (var x in Model.Kols)
                            {
                                string cssClass = (x.Nature != x.MandehNature && x.MandehNature != 3 && x.Nature != 3) ? "bg-warning text-black" : "";
                                <tr class="accountBrowser_item @cssClass" data-target="@x.Id" data-url="@Url.Action("AccountBrowserMoein","AccReports",new{Area=""})">
                                    <td class="text-center">@row</td>
                                    <td>@x.KolCode</td>
                                    <td>@x.KolName</td>
                                    <td>@x.Nature.AccToNatureName()</td>
                                    <td>@(x.Bed > 0 ? x.Bed.ToPrice() : "0")</td>
                                    <td>@(x.Bes > 0 ? x.Bes.ToPrice() : "0")</td>
                                    <td>@(x.Mandeh > 0 ? x.Mandeh.ToPrice() : "0")</td>
                                    <td>@x.MandehNature.AccToNatureName()</td>
                                </tr>

                                row++;
                            }
                        }
                        else
                        {
                            <tr>
                                <td colspan="8">
                                    <div class="alert alert-primary my-3 text-center" role="alert">
                                        @ViewBag.Allert
                                    </div>
                                </td>
                            </tr>
                        }

                    </tbody>
                </table>


            </div>
        </div>
        <div class="alert alert-secondary alert-dismissible m-0 mt-5" role="alert">
            <div class="row">
                <div class="col-md-8"></div>
                <div class="col-md-4">
                    <ul class="docfooter-totalAmounts">
                        <li>
                            <label>جمع بدهکار : </label>
                            <div>

                                <input type="text" readonly value="@strTotalBed" />
                                <span class="text-sm-end">ريال</span>
                            </div>
                        </li>
                        <li>
                            <label>جمع بستانکار : </label>
                            <div>
                                <input type="text" readonly value="@strTotalBes" />
                                <span class="text-sm-end">ريال</span>
                            </div>
                        </li>
                        <li>
                            <label class="docBalance">
                                @if (status == "بدهکار")
                                {
                                    <span class="badge badge-dot bg-label-primary px-3">@status</span>
                                }
                                else if (status == "بستانکار")
                                {
                                    <span class="badge badge-dot bg-label-warning px-3">@status</span>
                                }
                                else
                                {
                                    <span class="badge badge-dot bg-label-success px-3">تـراز</span>
                                }

                            </label>
                            <div>
                                <input type="text" readonly value="@strEkhtelaf" />
                                <span class="text-sm-end">ريال</span>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>

        </div>
    </div>
</div>

