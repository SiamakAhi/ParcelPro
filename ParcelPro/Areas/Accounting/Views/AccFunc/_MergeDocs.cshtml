@model DocsMergeDto
@{
    long totalBed = Model.Articles.Sum(n => n.Bed);
    long totalBes = Model.Articles.Sum(n => n.Bes);
    long ekhtelaf = totalBed >= totalBes ? totalBed - totalBes : totalBes - totalBed;

    string strTotalBed = totalBed > 0 ? totalBed.ToPrice() : "0";
    string strTotalBes = totalBes > 0 ? totalBes.ToPrice() : "0";
    string strEkhtelaf = ekhtelaf > 0 ? ekhtelaf.ToPrice() : "0";
    string status = (ekhtelaf > 0 && totalBed > totalBes) ? "بدهکار" : ((ekhtelaf > 0 && totalBes > totalBed) ? "بستانکار" : "");
}
<div class="modal-dialog modal-simple modal-wide">

    <div class="modal-content p-md-5">
        <div class="custom-modal-header bg-customdark">
            <i class="bx bx-merge me-2"></i>
            <span>ادغام اسناد حسابداری</span>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
            <div class="form-header custom-card1 mb-3">
                <form asp-action="DocMerge_AddDoc" asp-controller="AccFunc" asp-area="Accounting" method="post">
                    <input type="hidden" asp-for="Doc.Id" value="@Guid.NewGuid()" />
                    <input type="hidden" asp-for="Doc.TypeId" value="1" />
                    @if(Model.Doc.DocsForMerge.Count > 0)
                    {
                        foreach (var d in Model.Doc.DocsForMerge)
                        {
                            <input type="hidden" asp-for="Doc.DocsForMerge" value="@d" />
                        }
                    }
                   
                    <div class="row">
                        <div class="col-md-4 mb-1">
                            <label class="form-label" asp-for="Doc.DocNumber"></label>
                            <input type="number" asp-for="Doc.DocNumber" class="form-control form-control-sm gonext" value="@ViewBag.DocNumber">
                        </div>
                        <div class="col-md-4 mb-1">
                            <label class="form-label" asp-for="Doc.strDocDate"></label>
                            <input type="text" asp-for="Doc.strDocDate" value="@ViewBag.DocDate" class="form-control form-control-sm  flatpickr-input gonext" placeholder="YYYY/MM/DD" id="docDate">
                        </div>
                        <div class="col-md-4 mb-1">
                            <label class="form-label" asp-for="Doc.AtfNumber"></label>
                            <input type="number" asp-for="Doc.AtfNumber" class="form-control form-control-sm  gonext">
                        </div>
                        <div class="col-md-12 mb-2">
                            @*<label class="form-label" asp-for="Doc.Description"></label>*@
                            <textarea rows="1" asp-for="Doc.Description" class="form-control form-control-sm  gonext" placeholder="شـرح سنـد"></textarea>
                        </div>
                    </div>
                    <div class="row mt-2">
                        <div class="col-md-9">
                            <div class="form-check">
                                <input class="form-check-input mdsa" asp-for="Doc.MergeSameAccount" type="checkbox" data-target="#tbl-mergedocs" data-url="@Url.Action("DocMerge_GetArticles","AccFunc",new{Area="Accounting"})">
                                <label class="form-check-label" asp-for="Doc.MergeSameAccount"> حسابهای مشابه ادغام شوند. </label>
                            </div>
                            <div class="form-check form-check-info">
                                <input class="form-check-input mdsa" asp-for="Doc.MergeSameTafsil" type="checkbox" checked="checked" data-target="#tbl-mergedocs" data-url="@Url.Action("DocMerge_GetArticles","AccFunc",new{Area="Accounting"})">
                                <label class="form-check-label fw-100" asp-for="Doc.MergeSameTafsil">ادغام حساب ها در سند با درنظر گرفتن حساب های تفصیلی 4 انجام شود. </label>
                            </div>
                        </div>
                        <div class="col-md-3 d-grid px-3">
                            <button type="button" class="btn btn-sm me-2 btn-primary accAjaxSubmit">ادغام سند</button>
                        </div>
                        
                    </div>
                </form>
            </div>

            <div class="form-details custom-card1">
                <div class="table-responsive-sm static-height-300" id="tbl-mergedocs">
                    <table class="table table-striped table-sm">
                        <thead class="table-dark">
                            <tr>
                                <th>ردیف</th>
                                <th>سند قدیم</th>
                                <th>کل</th>
                                <th>معین</th>
                                <th>تفصیل 4</th>
                                <th>بدهکار</th>
                                <th>بستانکار</th>
                            </tr>
                        </thead>
                        <tbody>
                            @if (Model.Articles?.Count > 0)
                            {
                                int row = 1;
                                foreach (var x in Model.Articles)
                                {
                                    <tr>
                                        <td>@row</td>
                                        <td>@x.DocNumber</td>
                                        <td>@x.KolName</td>
                                        <td>@x.MoeinName</td>
                                        <td>@x.Tafsil4Name</td>
                                        <td>@(x.Bed > 0 ? x.Bed.ToPrice() : "0")</td>
                                        <td>@(x.Bes > 0 ? x.Bes.ToPrice() : "0")</td>
                                    </tr>
                                    row++;
                                }

                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <div class="custom-box1">
                <ul class="docfooter-totalAmounts">
                    <li>
                        <label>جمع بدهکار : </label>
                        <div>
                            <input type="text" readonly value="@strTotalBed" />
                            <span class="text-sm-end">ريال</span>
                        </div>
                    </li>
                    <li>
                        <label>جمع بستانکار : </label>
                        <div>
                            <input type="text" readonly value="@strTotalBes" />
                            <span class="text-sm-end">ريال</span>
                        </div>
                    </li>
                    <li>
                        <label class="docBalance">
                            @if (status == "بدهکار")
                            {
                                <span class="badge badge-dot bg-label-primary px-3">@status</span>
                            }
                            else if (status == "بستانکار")
                            {
                                <span class="badge badge-dot bg-label-warning px-3">@status</span>
                            }
                            else
                            {
                                <span class="badge badge-dot bg-label-success px-3">تـراز</span>
                            }

                        </label>
                        <div>
                            <input type="text" readonly value="@strEkhtelaf" />
                            <span class="text-sm-end">ريال</span>
                        </div>
                    </li>
                </ul>
            </div>
           
        </div>
    </div>
</div>

<script src="~/js/forms-selects.js"></script>
