@model CustomerManagementViewModel
@{
    ViewData["Title"] = "مدیریت مشتری";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="container mt-5">
    <div class="row">
        <!-- بخش اطلاعات مشتری -->
        <div class="col-lg-4 mb-4">
            <div class="card bg-primary text-white">
                <div class="card-header">
                    <h5 class="mb-0  text-white">اطلاعات مشتری</h5>
                </div>
                <div class="card-body">
                    <p><strong>نام:</strong> @Model.Customer.FName @Model.Customer.LName</p>
                    <p><strong>ایمیل:</strong> @Model.Customer.Email</p>
                    <p><strong>تلفن:</strong> @Model.Customer.Phone</p>
                    <p><strong>کد ملی:</strong> @Model.Customer.NationalId</p>
                    <p><strong>کد اقتصادی:</strong> @Model.Customer.EconomicNumber</p>
                </div>
            </div>
        </div>

        <!-- بخش کاربران مشتری -->
        <div class="col-lg-8 mb-4">
            <div class="card">
                <div class="card-header bg-success ">
                    <h5 class="mb-0 p-0 text-white">کاربران مشتری</h5>
                </div>
                <div class="card-body">
                    <table class="table table-striped table-hover">
                        <thead>
                            <tr>
                                <th>نام کاربری</th>
                                <th>نام</th>
                                <th>ایمیل</th>
                                <th>تلفن</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var user in Model.CustomerUsers)
                            {
                                <tr>
                                    <td>@user.UserName</td>
                                    <td>@user.FullName
                                    <td>@user.email</td>
                                    <td>@user.phoneNumber</td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <!-- بخش افزودن لایسنس جدید -->
        <div class="col-lg-4 mb-4">
            <div class="card ">
                <div class="card-header bg-warning">
                    <h5 class="mb-0 text-white">افزودن لایسنس جدید</h5>
                </div>
                <div class="card-body">
                    <form asp-action="AddLicense" asp-controller="CustomerLicense" asp-area="AvaRasta" method="post" class="row mt-2 g-3 fv-plugins-bootstrap5 fv-plugins-framework">
                        <input type="hidden" asp-for="NewLicense.Id" value="@Guid.NewGuid()" />
                        <input type="hidden" asp-for="NewLicense.CustomerId" value="@Model.Customer.Id" />
                        <div class="row">
                            <div class="col-12">
                                <label class="form-label" asp-for="NewLicense.ModuleId"></label>
                                <select type="text" asp-for="NewLicense.ModuleId" class="form-control">
                                    <option value="null">انتخاب</option>
                                </select>
                                <span asp-validation-for="NewLicense.ModuleId" class="text-danger"></span>
                            </div>
                            <div class="col-12">
                                <label class="form-label" asp-for="NewLicense.PurchaseDate"></label>
                                <input type="text" asp-for="NewLicense.PurchaseDate" value="@DateTime.Now.LatinToPersian()" class="form-control form-control-sm flatpickr-input" placeholder="YYYY/MM/DD">
                                <span asp-validation-for="NewLicense.PurchaseDate" class="text-danger"></span>
                            </div>
                            <div class="col-12">
                                <label class="form-label" asp-for="NewLicense.ExpirationDate"></label>
                                <input type="text" asp-for="NewLicense.ExpirationDate" value="@DateTime.Now.AddYears(1).LatinToPersian()" class="form-control form-control-sm flatpickr-input" placeholder="YYYY/MM/DD">
                                <span asp-validation-for="NewLicense.ExpirationDate" class="text-danger"></span>
                            </div>
                        </div>
                       
                        <div class="col-12 text-center mt-4 d-grid px-3">
                            <button type="submit" class="btn btn-primary me-sm-3 me-1">افزودن لایسنس</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        <!-- بخش لیست لایسنس‌ها -->
        <div class="col-lg-8 mb-4">
            <div class="card card-info">
                <div class="card-header">
                    <h5 class="mb-0">لیست لایسنس‌ها</h5>
                </div>
                <div class="card-body">
                    <table class="table table-striped table-hover">
                        <thead>
                            <tr>
                                <th>ماژول</th>
                                <th>تاریخ خرید</th>
                                <th>تاریخ انقضا</th>
                                <th>عملیات</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var license in Model.Licenses)
                            {
                                <tr>
                                    <td>@license.Module.Name</td>
                                    <td>@license.PurchaseDate.LatinToPersian()</td>
                                    <td>@license.ExpirationDate.LatinToPersian()</td>
                                    <td>
                                        <form asp-action="RemoveLicense" method="post" class="d-inline">
                                            <input type="hidden" name="id" value="@license.Id" />
                                            <input type="hidden" name="customerId" value="@Model.Customer.Id" />
                                            <button type="submit" class="btn btn-danger">حذف</button>
                                        </form>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

</div>
