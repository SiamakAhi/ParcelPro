@model DocReportDto
@{
    ViewData["Title"] = " دفتر روزنامه";
    Layout = "~/Views/Shared/_Layout.cshtml";
    long totalBed = Model.ArticlesPagin.Items.Sum(n => n.Bed);
    long totalBes = Model.ArticlesPagin.Items.Sum(n => n.Bes);
    long ekhtelaf = totalBed >= totalBes ? totalBed - totalBes : totalBes - totalBed;

    string strTotalBed = totalBed > 0 ? totalBed.ToPrice() : "0";
    string strTotalBes = totalBes > 0 ? totalBes.ToPrice() : "0";
    string strEkhtelaf = ekhtelaf > 0 ? ekhtelaf.ToPrice() : "0";
    string status = (ekhtelaf > 0 && totalBed > totalBes) ? "بدهکار" : ((ekhtelaf > 0 && totalBes > totalBed) ? "بستانکار" : "");
}

<div class="card page-header-panel">
    <div class="row">
        <div class="col-md-1">
            <div class="card-panel-header">
                <div><span class="card-panel-title">روزنامـه </span> </div>
            </div>
        </div>
        <div class="col-md-11">
            <form asp-action="ReportArticles" asp-controller="AccReports" asp-area="Accounting" method="get" id="frmFilterRooznameh">
                <div class="row">
                    <div class="col-md-10">
                        <div class="card-header-panel-section">
                            <div class="card-header-panel-section-header p-0"><span>فیلتر  </span></div>
                            <div class="card-header-panel-section-body">
                                <div class="row">
                                    <div class="col-md-4">
                                        <div class="row">
                                            <div class=" col-md-6 mb-2">
                                                <div class="garnet-input-group1 garnet-input-group-light">
                                                    <label asp-for="filter.FromDocNumer">‌از شماره سند</label>
                                                    <input type="number" asp-for="filter.FromDocNumer">
                                                </div>
                                            </div>
                                            <div class=" col-md-6 mb-2">
                                                <div class="garnet-input-group1 garnet-input-group-light">
                                                    <label asp-for="filter.ToDocNumer">‌تا شماره سند</label>
                                                    <input type="number" asp-for="filter.ToDocNumer">
                                                </div>
                                            </div>
                                            <div class="col-md-12 mb-2">
                                                <div class="garnet-input-group1 garnet-input-group-light">
                                                    <label asp-for="filter.StartDate">از تاریخ‌</label>
                                                    <input type="text" asp-for="filter.strStartDate" class="flatpickr-input" placeholder="YYYY/MM/DD">
                                                </div>
                                            </div>
                                            <div class="col-md-12 mb-2">
                                                <div class="garnet-input-group1 garnet-input-group-light">
                                                    <label asp-for="filter.strEndDate">تا تاریخ‌</label>
                                                    <input type="text" asp-for="filter.strEndDate" class="flatpickr-input" placeholder="YYYY/MM/DD">
                                                </div>
                                            </div>
                                            <div class="col-md-12 mb-2">
                                                <div class="garnet-input-group1 garnet-input-group-light">
                                                    <label asp-for="filter.Description">‌کلید واژه </label>
                                                    <input type="text" asp-for="filter.Description" placeholder="جستجو در شرح سند، شرح آرتیکل و ...">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-5">
                                        <div class="row">
                                            <div class="col-md-12 mb-2 select2-dark">
                                                <div class="garnet-input-group1 garnet-input-group-light">
                                                    <label>حساب(های) معین</label>
                                                    <select asp-for="filter.MoeinIds" class="select2 gonext" multiple asp-items="@ViewBag.Moeins">
                                                        <option value="null">انتخاب کنید ...</option>
                                                    </select>
                                                </div>
                                            </div>

                                            <div class="col-md-12 mb-2 select2-dark">
                                                <div class="garnet-input-group1 garnet-input-group-light">
                                                    <label>تفصیل 4</label>
                                                    <select asp-for="filter.Tafsil4Ids" class="select2 gonext" multiple asp-items="@ViewBag.Tafsils">
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="col-md-12 mb-2 select2-dark">
                                                <div class="garnet-input-group1 garnet-input-group-light">
                                                    <label>تفصیل 5</label>
                                                    <select asp-for="filter.Tafsil5Ids" class="select2 gonext" multiple asp-items="@ViewBag.Tafsils">
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="col-md-12 mb-2 select2-dark">
                                                <div class="garnet-input-group1 garnet-input-group-light">
                                                    <label>تفصیل 6</label>
                                                    <select asp-for="filter.Tafsil6Ids" class="select2 gonext" multiple asp-items="@ViewBag.Tafsils">
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="row">
                                            <div class="col-md-12 mb-2">
                                                <div class="garnet-input-group1 garnet-input-group-light">
                                                    <label class="form-label">مبلغ</label>
                                                    <input type="text" class="text-center numberInput" asp-for="filter.strAmount">
                                                </div>
                                            </div>
                                            <div class="col-md-12 mb-2">
                                                <div class="garnet-checkbox-group1 garnet-input-group-light">
                                                    <input asp-for="filter.SearchAmountFild" checked type="radio" value="3" id="SearchAmountFild1">
                                                    <label for="SearchAmountFild1"> جستجو در بدهکار و بستانکار </label>
                                                </div>
                                            </div>
                                           <div class="col-md-12 mb-2">
                                                <div class="garnet-checkbox-group1 garnet-input-group-light">
                                                    <input asp-for="filter.SearchAmountFild" type="radio" value="1" id="SearchAmountFild2">
                                                    <label for="SearchAmountFild2"> فقط بدهکار </label>
                                                </div>
                                            </div>
                                            <div class="col-md-12 mb-2">
                                                <div class="garnet-checkbox-group1 garnet-input-group-light">
                                                    <input asp-for="filter.SearchAmountFild" type="radio" value="2" id="SearchAmountFild3">
                                                    <label for="SearchAmountFild3"> فقط بستانکار </label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-2">
                        <div class="card-header-panel-section">
                            <div class="card-header-panel-section-header"><span>عملیات </span></div>
                            <div class="card-header-panel-section-body">
                                <div class="row">
                                    <div class="col-12 d-grid px-2">
                                        <button type="submit" class="garnet-btn garnet-btn-warning mb-2">
                                            <i class="tf-icons bx bx-list mx-1"></i>
                                            مشاهده اسناد
                                        </button>
                                    </div>
                                    <div class="col-12 d-grid px-2">
                                        <a href="javascript:void(0)" data-url="@Url.Action("", "AccExport", new { Area = "Accounting" })" class="garnet-btn garnet-btn-info mb-2 submitCustomForm">
                                            <i class="bx bx-printer mx-1"></i>
                                            چاپ گزارش
                                        </a>
                                    </div>
                                    <div class="col-12 d-grid px-2">
                                        <a href="javascript:void(0)" data-formid="frmFilterRooznameh" data-url="@Url.Action("ExportRooznameh", "AccExport", new { Area = "Accounting" })" class="garnet-btn garnet-btn-info mb-2 submitCustomForm">
                                            <i class="tf-icons bx bx-save mx-1"></i>
                                            خروجی اکسل
                                        </a>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <div class="card-body">
        <div class="table-responsive text-nowrap static-height-600">
            <table class="table table-bordered table-hover table-striped">
                <thead class="table-dark">
                    <tr>
                        <th class="text-center">ردیف</th>
                        <th>شماره سند</th>
                        <th>تاریخ سند</th>
                        <th>حساب کل</th>
                        <th>حساب معین</th>

                        @if (Model.Articles.Any(n => n.Tafsil4Id != null))
                        {
                            <th>4تفضیلی</th>
                        }
                        @if (Model.Articles.Any(n => n.Tafsil5Id != null))
                        {
                            <th>تفضیلی5</th>
                        }
                        @if (Model.Articles.Any(n => n.Tafsil6Id != null))
                        {
                            <th>تفضیلی6</th>
                        }
                        @if (Model.Articles.Any(n => n.Tafsil7Id != null))
                        {
                            <th>تفضیلی7</th>
                        }
                        @if (Model.Articles.Any(n => n.Tafsil8Id != null))
                        {
                            <th>تفضیلی8</th>
                        }
                        <th>بدهکار</th>
                        <th>بستانکار</th>
                        <th>شرح</th>
                    </tr>
                </thead>
                <tbody class="table-border-bottom-0">
                    @if (Model.Articles?.Count() > 0)
                    {
                        int row = 1;
                        foreach (var x in Model.Articles)
                        {
                            <tr class="dblc-link" data-url="@Url.Action("Doc", "OpAccoucnting", new { Area = "", id = x.DocId })">
                                <td class="text-center">@row</td>
                                <td>@x.DocNumber</td>
                                <td>@x.DocDate.Value.LatinToPersian()</td>
                                <td>@x.KolName</td>
                                <td>@x.MoeinName</td>
                                @if (Model.Articles.Any(n => n.Tafsil4Id != null))
                                {
                                    <td>@x.Tafsil4Name</td>
                                }
                                @if (Model.Articles.Any(n => n.Tafsil5Id != null))
                                {
                                    <td>@x.Tafsil5Name</td>
                                }
                                @if (Model.Articles.Any(n => n.Tafsil6Id != null))
                                {
                                    <td>@x.Tafsil6Name</td>
                                }
                                @if (Model.Articles.Any(n => n.Tafsil7Id != null))
                                {
                                    <td>@x.Tafsil7Name</td>
                                }
                                @if (Model.Articles.Any(n => n.Tafsil8Id != null))
                                {
                                    <td>@x.Tafsil8Name</td>
                                }
                                <td>@(x.Bed > 0 ? x.Bed.ToPrice() : "0")</td>
                                <td>@(x.Bes > 0 ? x.Bes.ToPrice() : "0")</td>
                                <td>@x.Comment</td>
                            </tr>

                            row++;
                        }
                    }
                    else
                    {
                        <tr>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                    }

                </tbody>
            </table>
        </div>
    </div>
    <div class="card-footer">
        <div class="alert alert-secondary m-0 mt-2" role="alert">
            <div class="row">
                <div class="col-md-6">
                </div>
                <div class="col-md-6">
                    <ul class="docfooter-totalAmounts">
                        <li>
                            <label>جمع بدهکار : </label>
                            <div>
                                <input type="text" readonly value="@strTotalBed" />
                                <span class="text-sm-end">ريال</span>
                            </div>
                        </li>
                        <li>
                            <label>جمع بستانکار : </label>
                            <div>
                                <input type="text" readonly value="@strTotalBes" />
                                <span class="text-sm-end">ريال</span>
                            </div>
                        </li>
                        <li>
                            <label class="docBalance">
                                @if (status == "بدهکار")
                                {
                                    <span class="badge badge-dot bg-label-danger px-3">@status</span>
                                }
                                else if (status == "بستانکار")
                                {
                                    <span class="badge badge-dot bg-label-danger px-3">@status</span>
                                }
                                else
                                {
                                    <span class="badge badge-dot bg-label-success px-3">تـراز</span>
                                }

                            </label>
                            <div>
                                <input type="text" class="text-danger" readonly value="@strEkhtelaf" />
                                <span class="text-sm-end">ريال</span>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>

        </div>
    </div>
</div>


